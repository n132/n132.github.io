---
title: "Introduction of Kernel Exploitations: Double Fetch"
date: 2022-05-19 17:52:21
tags: 
layout: default
---

# 0x00 Prilogue
I only have little experience with kernel pwn. During the `Intro_to_OS` course, I read a lot of kernel code of `xv6` and learned the kernel systematically. Although `xv6` is a simple system while the `Linux` kernel is much more complex, the knowledge from `xv6` learned helps a lot.

This post would not go too deep into the kernel because I am too weak to do that and I got all the solution ideas from `CTF-wiki`. You can also download the attachments at this [link][1]

# 0x01 Double Fetch

![Double Fetch from CTF-Wiki](/Figures/kernel/double-fetch.png)

Double fetch is a kind of race condition. Most situation the kernel would get the data from user space by `copy_from_user`. But while dealing with complex data structure, the kernel read the data from user space by a pointer. So there is a race condition:
```c
kernel  : get the data and perform some check
users   : change the data
kernel  : perfrom options to the data
```

# 0x02 Analysis

[attachment][2]


# Summary
The second solution(ptmx) is significant and it's a very general solution for kernel-heap exploitation. 


[1]: https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/kernel
[2]: https://github.com/n132/attachment
[3]: https://github.com/n132/attachment/tree/main/CISCN_2017
[4]: https://code.woboq.org/linux/linux/include/linux/tty.h.html#tty_struct
[5]: https://code.woboq.org/linux/linux/include/linux/tty_driver.h.html#tty_operations