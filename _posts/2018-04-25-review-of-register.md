---
title: review：register
date: 2018-04-25 14:34:50
tags: basic
layout: post
---
复习一下寄存器

<!--more-->

# 寄存器

本文主要记录几个关键寄存器
旨在加深印象 巩固基础

## 寄存器
    [百科][1]
    
## rsp/esp & rbp/rsp

    rsp/esp :栈指针 指向栈顶
    rbp/ebp :栈指针 指向栈底
    
    栈由高向低生长所以ebp决定了当前栈的开始地址
    esp决定了当前栈顶的元素
    因为读数据和写数据都是从低往高读的所以可以在gdb中用
    x命令和$esp结合来读取栈上内容
    例如
        ```
        x/20wx $esp
        ```
    和栈指针关系比较大的几条汇编指令：
    ```
    leave;
    ret ;
    ```
    等价于
    ```
    mov ebp , esp;
    pop ebp;
    ret ;
    ```
    一般出现在函数的结束位置
    用于进行堆栈平衡
    
    最常见的利用是 stack migration中通过对ebp&esp的控制来欺骗程序来到自己构造的栈上
    
## PC & EIP
    程序计数器
    程序计数器是计算机处理器中的寄存器，它包含当前正在执行的指令的地址（位置）。当每个指令被获取，程序计数器的存储地址加一。
    
    指令寄存器 EIP
EIP —— 标志当前进程将要执行指令位置，在64位模式下扩展为 RIP 64位指令寄存器。

## EAX/RAX
    eax    累加和结果寄存器
    EAX寄存器以称为累加器，AX寄存器是算术运算的主要寄存器， 所有的输入、输出只使用AL或AX人作为数据寄存器。 
    很多函数的返回结果会存在eax寄存器中

## EDI/RDI ESI/RSI
    变址和指针寄存器
    它们主要用于存放存储单元在段内的偏移量。
    （段内偏移量）
    用它们可实现多种存储器操作数的寻址方式，为以不同的地址形式访问存储单元提供方便。
    在X86-64中
    rdi rsi 作为参数寄存器 分别为第一第二个参数
    控制了他们就控制了前两个参数

## RDX
    数据寄存器
    x86-64位操作系统下是
    第3个函数参数
    
## RCX
    计数寄存器
    常用来保存计数值，如在循环、位移和串处理指令中作隐含计数器
    x86-64位操作系统下是
    第4个函数参数
    
上面是几个重要的寄存器,在32位系统下
平时用到比较多的是ebp，esp，eax

一份总结有关x86-64的寄存器使用：（[转载][2]
2进制基础知识很好的的一篇博客）

    %rax 作为函数返回值使用。
    %rsp 栈指针寄存器，指向栈顶
    %rdi，%rsi，%rdx，%rcx，%r8，%r9 用作函数参数，依次对应第1参数，第2参数。。。
    %rbx，%rbp，%r12，%r13，%14，%15 用作数据存储，遵循被调用者使用规则，简单说就是随便用，调用子函数之前要备份它，以防他被修改
    %r10，%r11 用作数据存储，遵循调用者使用规则，简单说就是使用之前要先保存原值
    
## 寄存器保存惯例

过程调用中，调用者栈帧需要寄存器暂存数据，被调用者栈帧也需要寄存器暂存数据。如果调用者使用了%rbx，那被调用者就需要在使用之前把%rbx保存起来，然后在返回调用者栈帧之前，恢复%rbx。遵循该使用规则的寄存器就是被调用者保存寄存器，对于调用者来说，%rbx就是非易失的。
反过来，调用者使用%r10存储局部变量，为了能在子函数调用后还能使用%r10，调用者把%r10先保存起来，然后在子函数返回之后，再恢复%r10。遵循该使用规则的寄存器就是调用者保存寄存器，对于调用者来说，%r10就是易失的
    
    


  [1]: https://baike.baidu.com/item/%E5%AF%84%E5%AD%98%E5%99%A8
  [2]: https://blog.csdn.net/u013737447/article/details/49154509