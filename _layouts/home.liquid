---
layout: default
---

<style>
  /* === Home-specific styles === */
  .pz-content-wrap {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .pz-posts-col {
    flex: 1;
    min-width: 0;
  }

  .pz-side-col {
    flex-shrink: 0;
    width: 220px;
    position: sticky;
    top: 20px;
    padding-top: 0.5rem;
  }

  .pz-search-box input {
    width: 100%;
    padding: 0.5rem 0.6rem;
    font-size: 0.9rem;
    border: 1.5px solid #ddd;
    border-radius: 3px;
    background: transparent;
    box-sizing: border-box;
    outline: none;
    transition: border-color 0.2s;
    font-family: inherit;
  }

  .pz-search-box input:focus {
    border-color: #1a1a1a;
  }

  .pz-search-count {
    margin-top: 0.3rem;
    font-size: 0.75rem;
    color: #999;
  }

  /* === Year headings === */
  .pz-year-heading {
    margin-top: 2.5rem;
    margin-bottom: 0.8rem;
    font-size: 0.8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #aaa;
  }

  .pz-post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  /* === Post items === */
  .pz-post-item {
    padding: 1.4rem 0;
    border-bottom: 1px solid #eee;
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
  }

  .pz-post-item:last-child {
    border-bottom: none;
  }

  .pz-post-thumb {
    flex-shrink: 0;
    width: 180px;
    height: 110px;
    border-radius: 4px;
    overflow: hidden;
  }

  .pz-post-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .pz-post-body {
    flex: 1;
    min-width: 0;
  }

  .pz-post-title {
    margin: 0 0 0.25rem 0;
    font-size: 1.35rem;
    font-weight: 700;
    line-height: 1.35;
  }

  .pz-post-title a {
    color: #1a1a1a;
    text-decoration: none;
  }

  .pz-post-title a:hover {
    color: #555;
  }

  .pz-post-date {
    font-size: 0.85rem;
    color: #999;
  }

  .pz-post-excerpt {
    margin-top: 0.5rem;
    font-size: 1rem;
    color: #444;
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .pz-read-more {
    display: inline-block;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: #1a1a1a;
    text-decoration: none;
    font-weight: 600;
  }

  .pz-read-more:hover {
    text-decoration: underline;
  }

  .pz-read-more::after {
    content: " \2192";
  }

  /* === "more posts" === */
  .pz-more-posts {
    margin: 3rem 0 1rem 0;
    text-align: center;
  }

  .pz-more-posts button {
    font-size: 2.5rem;
    font-weight: 900;
    color: #1a1a1a;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    font-family: inherit;
    letter-spacing: -0.02em;
    transition: color 0.2s;
  }

  .pz-more-posts button:hover {
    color: #555;
  }

  /* === Responsive === */
  @media (max-width: 768px) {
    .pz-content-wrap {
      flex-direction: column-reverse;
      gap: 1rem;
    }
    .pz-side-col {
      width: 100%;
      position: static;
    }
    .pz-post-item {
      flex-direction: column;
      gap: 0.8rem;
    }
    .pz-post-thumb {
      width: 100%;
      height: 180px;
    }
    .pz-more-posts button {
      font-size: 1.8rem;
    }
  }
</style>

<!-- Content area: posts + sidebar search -->
<div class="pz-content-wrap">
  <div class="pz-posts-col">
    {% assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" %}
    {% for year_group in posts_by_year %}
      <div class="year-group" data-year="{{ year_group.name }}">
        <div class="pz-year-heading">{{ year_group.name }}</div>
        <ul class="pz-post-list">
          {% assign preview_images = site.static_files | where_exp: "file", "file.path contains '/assets/img/preview/'" %}
          {% for post in year_group.items %}
            {% assign first_img = nil %}
            {% if post.image %}
              {% assign first_img = post.image | relative_url %}
            {% elsif post.content contains '<img ' %}
              {% assign img_split = post.content | split: 'src="' %}
              {% if img_split.size > 1 %}
                {% assign first_img = img_split[1] | split: '"' | first %}
              {% endif %}
            {% endif %}
            {% unless first_img %}
              {% if preview_images.size > 0 %}
                {% assign hash_val = post.date | date: "%s" | plus: 0 %}
                {% assign img_index = hash_val | modulo: preview_images.size %}
                {% assign first_img = preview_images[img_index].path | relative_url %}
              {% endif %}
            {% endunless %}
            <li class="pz-post-item">
              {% if first_img %}
                <a href="{{ post.url | relative_url }}" class="pz-post-thumb">
                  <img src="{{ first_img }}" alt="" loading="lazy" />
                </a>
              {% endif %}
              <div class="pz-post-body">
                <h3 class="pz-post-title">
                  <a href="{{ post.url | relative_url }}">{{ post.title | escape }}</a>
                </h3>
                <div class="pz-post-date">{{ post.date | date: "%Y-%b-%d" }}</div>
                {% assign body_html = post.content | split: '<!--more-->' | last %}
                {% assign body_marked = body_html | replace: '<h1', 'XHSX<h1' | replace: '<h2', 'XHSX<h2' | replace: '<h3', 'XHSX<h3' | replace: '<h4', 'XHSX<h4' %}
                {% assign body_marked = body_marked | replace: '</h1>', '</h1>XHEX' | replace: '</h2>', '</h2>XHEX' | replace: '</h3>', '</h3>XHEX' | replace: '</h4>', '</h4>XHEX' %}
                {% assign body_text = body_marked | strip_html %}
                {% assign heading_parts = body_text | split: 'XHSX' %}
                {% assign clean_text = '' %}
                {% for part in heading_parts %}
                  {% if part contains 'XHEX' %}
                    {% assign after_heading = part | split: 'XHEX' | last %}
                    {% assign clean_text = clean_text | append: after_heading %}
                  {% else %}
                    {% assign clean_text = clean_text | append: part %}
                  {% endif %}
                {% endfor %}
                {% assign excerpt_text = clean_text | strip | truncatewords: 60 %}
                {% if excerpt_text.size > 0 %}
                  <div class="pz-post-excerpt">{{ excerpt_text }}</div>
                {% endif %}
                <a class="pz-read-more" href="{{ post.url | relative_url }}">Read more</a>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}

    <div class="pz-more-posts">
      <button id="more-posts-btn">more posts</button>
    </div>
  </div>

  <!-- Sidebar: search -->
  <div class="pz-side-col">
    <div class="pz-search-box">
      <input type="text" id="post-search" placeholder="search" autocomplete="off" />
      <div id="search-count" class="pz-search-count"></div>
    </div>
  </div>
</div>

<script>
(function() {
  var POSTS_PER_PAGE = 15;
  var input = document.getElementById('post-search');
  var countEl = document.getElementById('search-count');
  var moreBtn = document.getElementById('more-posts-btn');
  var moreBtnWrap = moreBtn.parentElement;
  var entries = Array.prototype.slice.call(document.querySelectorAll('.pz-post-item'));
  var yearGroups = document.querySelectorAll('.year-group');
  var total = entries.length;
  var shown = 0;

  function applyPaging() {
    var count = 0;
    entries.forEach(function(entry) {
      if (count < shown) {
        entry.removeAttribute('data-paged-hidden');
      } else {
        entry.setAttribute('data-paged-hidden', '1');
      }
      count++;
    });
    updateYearGroups();
    moreBtnWrap.style.display = (shown >= total) ? 'none' : '';
    countEl.textContent = total + ' posts';
  }

  function updateYearGroups() {
    yearGroups.forEach(function(group) {
      var items = group.querySelectorAll('.pz-post-item');
      var hasVisible = false;
      items.forEach(function(item) {
        if (item.style.display !== 'none' && !item.hasAttribute('data-paged-hidden')) {
          hasVisible = true;
        }
      });
      group.style.display = hasVisible ? '' : 'none';
    });
  }

  function renderVisibility() {
    entries.forEach(function(entry) {
      var pagedHidden = entry.hasAttribute('data-paged-hidden');
      var searchHidden = entry.hasAttribute('data-search-hidden');
      entry.style.display = (pagedHidden || searchHidden) ? 'none' : '';
    });
    updateYearGroups();
  }

  shown = Math.min(POSTS_PER_PAGE, total);
  applyPaging();
  renderVisibility();

  moreBtn.addEventListener('click', function() {
    shown = Math.min(shown + POSTS_PER_PAGE, total);
    applyPaging();
    renderVisibility();
  });

  input.addEventListener('input', function() {
    var query = this.value.toLowerCase().trim();
    var visible = 0;

    if (query) {
      entries.forEach(function(entry) {
        var text = entry.textContent.toLowerCase();
        var match = text.indexOf(query) !== -1;
        entry.removeAttribute('data-paged-hidden');
        if (match) {
          entry.removeAttribute('data-search-hidden');
          visible++;
        } else {
          entry.setAttribute('data-search-hidden', '1');
        }
      });
      moreBtnWrap.style.display = 'none';
      countEl.textContent = visible + ' of ' + total + ' posts';
    } else {
      entries.forEach(function(entry) {
        entry.removeAttribute('data-search-hidden');
      });
      applyPaging();
    }
    renderVisibility();
  });
})();
</script>
